<!-- Layout -->
<div id="app">
    <div id="about">
        <p>
            Your house is assessed to determine its Assessed Total Value, then
            excemptions are subtracted to it to produce the Assessed Taxable Value.
            This times the tax rate (in permil) produces your Tax Amount.
        </p>
        <p>
            If you add up the county, village and school tax rates, it comes to about
            $1,000, so your tax payments are about equal to the assessed value of your
            house. There are also the sewer and solid waste taxes, but those are much
            smaller.
        </p>
    </div>
    <div id="directions">
        <p>
            Enter the assessed taxable value of your house to find out what you pay in
            taxes and how you compare to everyone else. You can find your house's
            assessed total and taxable values [here]().
        </p>
    </div>
    <div id="input">
    </div>
    <table>
        <thead>
            <tr>
                <th class="levy-description">Levy Description</th>
                <th class="total-tax-levy">Total Tax Levy</th>
                <th class="percent-change">% Change from Prior Year</th>
                <th class="assessed-total-value">Assessed Total Value</th>
                <th class="assessed-taxable-value">Assessed Taxable Value</th>
                <th class="tax-rate">Tax Rate</th>
                <th class="tax-amount">Tax Amount</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td class="levy-description">2012 COUNTY TAX</td>
                <td class="total-tax-levy">27,078,607</td>
                <td class="percent-change">3.17</td>
                <td class="assessed-total-value"></td>
                <td class="assessed-taxable-value"></td>
                <td class="tax-rate">194.908400</td>
                <td class="tax-amount"></td>
            </tr>
            <tr>
                <td class="levy-description">2012-2013 VILLAGE TX</td>
                <td class="total-tax-levy">33,093,095</td>
                <td class="percent-change">3.72</td>
                <td class="assessed-total-value"></td>
                <td class="assessed-taxable-value"></td>
                <td class="tax-rate">238.420000</td>
                <td class="tax-amount"></td>
            </tr>
            <tr>
                <td class="levy-description">2012-2013 School Tax</td>
                <td class="total-tax-levy">127,045,773</td>
                <td class="percent-change">2.89</td>
                <td class="assessed-total-value"></td>
                <td class="assessed-taxable-value"></td>
                <td class="tax-rate">868.927000</td>
                <td class="tax-amount"></td>
            </tr>
        </tbody>
        <tfoot>
            <tr>
                <td colspan="6"></td>
                <td id="total-tax-amount" class="tax-amount"></td>
            </tr>
        </thead>
    </table>
</div>


<!-- Libraries -->
<script src="jquery.min.js" type="text/javascript"></script>
<script src="underscore-min.js" type="text/javascript"></script>
<script src="backbone-min.js"></script>
<script src="backbone.queryparams.js"></script>

<!-- Templates -->
<script type="text/template" id="input-basic">
    <form class="calculator">
        <label for="assessed-taxable-value">Assessed total value</label>
        <input id="slider" name="assessed-taxable-value" type="range" min="0" max="100000" value="<%= total %>" step="1000" />
    </form>
</script>
<script type="text/template" id="input-advanced">
    <form class="calculator">
        <label for="assessed-total-value">Assessed total value</label>
        <input name="assessed-total-value" type="text" value="<%= total %>" />
        <label for="assessed-taxable-value-county">Assessed taxable value for county tax</label>
        <input name="assessed-taxable-value-county" type="text" value="<%= taxable_county %>" />
        <label for="assessed-taxable-value-village">Assessed taxable value for village tax</label>
        <input name="assessed-taxable-value-village" type="text" value="<%= taxable_village %>" />
        <label for="assessed-taxable-value-school">Assessed taxable value for school tax</label>
        <input name="assessed-taxable-value-school" type="text" value="<%= taxable_school %>" />
        <input type="submit" value="Go">
    </form>
</script>
<script type="text/template" id="distribution">
    <ul>
        <li>Your assessed total value in the <%= total %>th percentile of assessed total values.</li>
        <li>Your assessed taxable value for county taxes is in the <%= taxable_county %>th percentile.</li>
        <li>Your assessed taxable value for village taxes is in the <%= taxable_village %>th percentile.</li>
        <li>Your assessed taxable value for school taxes is in the <%= taxable_school %>th percentile.</li>
    </ul>
</script>

<script>
    // Views for basic and advanced statistics
    var InputView = Backbone.View.extend({
        el: "#input",
        render: function(template_css, houseparams) {
            var median = 19000
            // Parse parameters
            if (!houseparams) {
                var houseparams = {}
            }

            var fields = ['total', 'taxable_county', 'taxable_village', 'taxable_school']
            fields.map(function(name){
                if (!houseparams[name]) {
                    houseparams[name] = median
                }
            })

            var template = _.template($(template_css).html(), houseparams)
            this.$el.html(template)
        },
        calculate: function(e) {
            alert('aoeu')
            $(ev.currentTarget).serializeObject()
        },
        events: {
            "click *": "calculate"
        }
    })

    // Routes
    var inputView = new InputView()
    var Router = Backbone.Router.extend({
        routes: {
            "": "calculator",
        },
        calculator: function(params){
            if (!params) {
                var params = {}
            }
            if (params.advanced === 'true'){
                inputView.render('#input-advanced', params)
            } else {
                inputView.render('#input-basic', params)
            }
        }
    })

    // Go
    var router = new Router()
    Backbone.history.start()
</script>
